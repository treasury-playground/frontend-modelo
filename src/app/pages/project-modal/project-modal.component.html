<div class="modal-backdrop fade show"></div>
<div class="modal d-block" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content border-0 rounded-3 shadow-sm">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title fw-bold">{{ isEditMode ? 'Edit Project' : 'New Project' }}</h5>
        <button type="button" class="btn-close" (click)="close.emit()"></button>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSave()" class="needs-validation" novalidate>
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-3">
              <label class="form-label small text-muted">Nome do Projeto</label>
              <input type="text" formControlName="name" class="form-control" placeholder="Nome do Projeto" />
              <div class="text-danger small mt-1" *ngIf="submitted && form.get('name')?.invalid">
                Campo obrigatório.
              </div>
            </div>

            <div class="col-md-3">
              <label class="form-label small text-muted">Coordenador</label>
              <input type="text" formControlName="coordinator" class="form-control" placeholder="Nome do Coordenador" />
              <div class="text-danger small mt-1" *ngIf="submitted && form.get('coordinator')?.invalid">
                Campo obrigatório.
              </div>
            </div>

            <div class="col-md-3">
              <label class="form-label small text-muted">Estudantes</label>
              <select class="form-select form-select-sm" [(ngModel)]="selectedStudent" [ngModelOptions]="{standalone: true}">
                <option value="" disabled selected>Selecionar estudante</option>
                <option *ngFor="let student of availableStudents" [value]="student">{{ student }}</option>
              </select>
            </div>

            <div class="col-md-2">
              <label class="form-label small text-muted">Papel</label>
              <select class="form-select form-select-sm" [(ngModel)]="selectedRole" [ngModelOptions]="{standalone: true}">
                <option value="" disabled selected>Selecionar papel</option>
                <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
              </select>
            </div>

            <div class="col-md-1 d-flex align-items-end">
              <button type="button" class="btn btn-outline-primary w-100 py-1" (click)="assignStudentWithRole()">
                <i class="bi bi-plus"></i>
              </button>
            </div>
          </div>

          <div *ngIf="assignedStudents.length > 0" class="mb-3 d-flex flex-wrap gap-2">
            <ng-container *ngFor="let student of assignedStudents">
              <span
                class="badge rounded-pill border px-3 py-1 small d-flex align-items-center"
                [ngClass]="{
                  'bg-warning text-dark': student.role === 'Trainee',
                  'bg-info text-dark': student.role === 'Junior',
                  'bg-success text-white': student.role === 'Senior',
                  'bg-primary text-white': student.role === 'Master'
                }">
                {{ student.name }} — {{ student.role }}
                <i class="bi bi-x ms-2" style="cursor: pointer;" (click)="removeAssignedStudent(student.name)"></i>
              </span>
            </ng-container>
          </div>

          <div class="mb-3">
            <label class="form-label small text-muted">Descrição</label>
            <textarea formControlName="description" class="form-control" rows="3" [maxLength]="maxChars" placeholder="Descrição do projeto..."></textarea>
            <div class="text-end small text-muted mt-1">{{ descriptionLength }}/{{ maxChars }}</div>
            <div class="text-danger small mt-1" *ngIf="submitted && form.get('description')?.invalid">
              Campo obrigatório.
            </div>
          </div>

          <div class="modal-footer border-top-0">
            <button type="button" class="btn btn-outline-secondary px-4" (click)="close.emit()">Cancelar</button>
            <button type="submit" class="btn btn-primary px-4">
              {{ isEditMode ? 'Update' : 'Salvar' }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
