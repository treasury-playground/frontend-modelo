<div class="d-flex justify-content-between align-items-center mb-4"> 
  <h5 class="fw-bold">Listing</h5>
</div>

<div class="card shadow-sm p-4">
  <div class="position-relative mb-3">
    <input
      type="text"
      [formControl]="searchControl"
      class="form-control w-100 ps-3 pe-5"
      placeholder="Search by Project"
    />
    <i
      class="bi bi-search position-absolute top-50 end-0 translate-middle-y me-3 text-muted"
      style="pointer-events: none;"
    ></i>
  </div>

  <div class="mb-2 text-muted small">
    Projects ({{ filteredProjects.length < 10 ? '0' + filteredProjects.length : filteredProjects.length }})
  </div>

  <table class="table table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th></th>
        <th>Name of Project</th>
        <th>Description</th>
        <th>Date</th>
        <th>Coordinator</th>
        <th>Students</th>
        <th>
          <button
            class="btn btn-outline-secondary btn-sm me-1"
            [disabled]="!hasSelectedProjects()"
            (click)="downloadSelectedProjects()"
          >
            Download
          </button>

          <button
            *ngIf="userType === 'teacher'"
            class="btn btn-outline-danger btn-sm"
            [disabled]="!hasSelectedProjects()"
            (click)="deleteSelectedProjects()"
          >
            Delete
          </button>
        </th>

        <th *ngIf="userType === 'teacher'">
          <input
            type="checkbox"
            [(ngModel)]="selectAll"
            (change)="toggleSelectAll()"
          />
        </th>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngFor="let project of paginatedProjects; let i = index">
        <tr>
          <td>
            <i
              class="bi"
              [ngClass]="{
                'bi-chevron-down': expandedIndex === i,
                'bi-chevron-right': expandedIndex !== i
              }"
              (click)="toggleDetails(i)"
              role="button"
            ></i>
          </td>
          <td>{{ project.name }}</td>
          <td class="text-muted small">{{ project.description }}</td>
          <td>{{ project.date }}</td>
          <td>
            <span class="badge bg-info text-dark">{{ project.coordinator }}</span>
          </td>
          <td>
            <span *ngFor="let student of project.students" class="badge bg-secondary me-1">
              {{ student }}
            </span>
          </td>
          <td>
            <i
              *ngIf="userType === 'teacher'"
              class="bi bi-pencil text-primary"
              role="button"
              (click)="onEditProject(project)">
            </i>
          </td>
          <td *ngIf="userType === 'teacher'">
            <input type="checkbox" [(ngModel)]="project.selected" />
          </td>
        </tr>

        <tr *ngIf="expandedIndex === i">
          <td colspan="8">
            <div class="d-flex gap-4 p-3 border rounded">
              <div class="flex-fill">
                <img
                  src=""
                  class="img-fluid rounded shadow-sm"
                  alt="Preview"
                />
              </div>
              <div style="min-width: 300px;">
                <p><strong>Name of project:</strong> {{ project.name }}</p>
                <p><strong>Description:</strong> {{ project.description }}</p>
                <p><strong>Coordinator:</strong> <span class="badge bg-info text-dark">{{ project.coordinator }}</span></p>
                <p><strong>Students:</strong>
                  <ng-container *ngFor="let s of project.students">
                    <span class="badge bg-secondary me-1">{{ s }}</span>
                  </ng-container>
                </p>
                <p><strong>Upload:</strong> 7/17/2022 7:04 PM</p>
                <p><strong>Comments:</strong> Type: Document - Any generic document</p>
                <p><strong>Format:</strong> pdf</p>
                <p><strong>File Size:</strong> 820 KB</p>
              </div>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <span class="small text-muted">
      Showing {{ paginatedProjects.length }} of {{ filteredProjects.length }}
    </span>
    <div class="d-flex align-items-center gap-2">
      <button
        class="btn btn-sm btn-outline-primary"
        [disabled]="currentPage === 1"
        (click)="changePage(currentPage - 1)"
      >‹</button>
      <span>{{ currentPage }}</span>
      <button
        class="btn btn-sm btn-outline-primary"
        [disabled]="currentPage >= totalPages()"
        (click)="changePage(currentPage + 1)"
      >›</button>

      <select class="form-select form-select-sm ms-2" style="width: 70px;" [(ngModel)]="pageSize">
        <option [ngValue]="2">2</option>
        <option [ngValue]="4">4</option>
        <option [ngValue]="10">10</option>
      </select>
    </div>
  </div>

  <div class="text-end mt-4" *ngIf="userType === 'teacher'">
    <button class="btn btn-primary" (click)="openModal()">
      <i class="bi bi-plus-lg me-1"></i> Add New Project
    </button>
  </div>
</div>

<app-project-modal
  *ngIf="userType === 'teacher' && showModal"
  [isEditMode]="isEditMode"
  [projectToEdit]="projectBeingEdited"
  (close)="closeModal()">
</app-project-modal>
